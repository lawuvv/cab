<!DOCTYPE html>
<html>
    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <title>SADM Interpretação de Dados Gasométricos</title>

        <style media="screen">
            #main {
                text-align: center;
            }

            #area-texto {
                border: 1px solid gray;
                font-size: 20px;
            }
        </style>

    </head>

    <body>

        <div class="row">
            <div class="col-sm-offset-3 col-sm-6" id="main">
                <hr>
                <form class="form-horizontal">
                    <div class="form-group row">
                        <label class="control-label col-xs-offset-2 col-xs-3">pH:</label>
                        <div class="col-xs-3">
                            <div class="input-group">
                                <input type="text" class="form-control" name="ph" id="ph" value="">
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="control-label col-xs-offset-2 col-xs-3">PaCO2:</label>
                        <div class="col-xs-3">
                            <div class="input-group">
                                <input type="text" class="form-control" name="paco2" id="paco2" value="">
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="control-label col-xs-offset-2 col-xs-3">HCO3:</label>
                        <div class="col-xs-3">
                            <div class="input-group">
                                <input type="text" class="form-control" name="hco3" id="hco3" value="">
                            </div>
                        </div>
                    </div>

                    <div class="form-group row">
                        <label class="control-label col-xs-5">Quadro Clínico:</label>
                        <label class="radio-inline col-xs-2">
                            <input type="radio" name="optradio" id="rAguda">Aguda</label>
                        <label class="radio-inline col-xs-2">
                            <input type="radio" name="optradio" id="rCronica">Crônica</label>
                    </div>

                    <div class="form-group row">
                        <div class="btn btn-primary " onclick="diagnostico()">Diagnóstico</div>
                        <div class="col-xs-offset-2 btn btn-danger" onclick="limpar()">Limpar</div>
                    </div>
                    <hr>
                    <div class="row">
                        <div id="area-texto">

                        </div>
                    </div>
                </form>
            </div>
        </div>

        <script type="text/javascript">
            function limpar() {
                document.getElementById('ph').value = "";
                document.getElementById('paco2').value = "";
                document.getElementById('hco3').value = "";
                document.getElementById('area-texto').innerHTML = "";
            }

            function diagnostico() {

                var ph = parseFloat(document.getElementById('ph').value);
                var paco2 = parseFloat(document.getElementById('paco2').value);
                var hco3 = parseFloat(document.getElementById('hco3').value);
                var phHandHass = 6.1 + Math.log10(hco3 / (paco2 * 0.03));
                console.log(phHandHass);

                var checkAguda = document.getElementById('rAguda').checked;
                var checkCronica = document.getElementById('rCronica').checked;
                //console.log();

                var areaTexto = document.getElementById('area-texto');
                var diagn;

                if (!phHandHass) {
                    alert("Preencha todos os campos corretamente.");
                }
                else if(Math.abs(ph - phHandHass) > 0.05) {
                    areaTexto.innerHTML = "Gasometria duvidosa. (Verificar calibragem dos aparelhos e os dados coletados do paciente)";
                }
                else{ //Gasometria válida
                    if (ph < 7.35) { //ph ácido
                        console.log("ph ácido");
                        diagn = "PH ácido.";
                        if (hco3 < 22 && paco2 > 45) {
                            console.log("Distúrbio Misto");
                            diagn += " Distúrbio Misto.";
                        }
                        else if (hco3 < 22) {
                            paco2Ini = 40 - (1 * (24 - hco3));
                            paco2Fin = 40 - (1.4 * (24 - hco3));
                            console.log(paco2Ini);
                            console.log(paco2Fin);
                            if (paco2 > paco2Fin && paco2 < paco2Ini) {
                                console.log("Acidose Metabólica");
                                diagn += " Acidose Metabólica Simples.";
                            }
                            else {
                                console.log("Acidose Metabólica associada a Alcalose Respiratória");
                                diagn += " Acidose Metabólica associada a Alcalose Respiratória.";
                            }
                        }
                        else if (paco2 > 45) {
                            hco3AgudaIni = 24 - (0.1 * (40 - paco2));
                            hco3AgudaFin = 24 - (0.2 * (40 - paco2));
                            hco3CronicaIni = 24 - (0.25 * (40 - paco2));
                            hco3CronicaFin = 24 - (0.55 * (40 - paco2));
                            console.log(hco3CronicaFin + " " + hco3CronicaIni);
                            if (!checkAguda && !checkCronica) {
                                alert("Selecione um Quadro Clínico.");
                                areaTexto.innerHTML = "";
                            }
                            else if ((hco3 > hco3AgudaIni && hco3 < hco3AgudaFin && checkAguda) || (hco3 > hco3CronicaIni && hco3 < hco3CronicaFin && checkCronica)) {
                                console.log("Acidose Respiratória");
                                diagn += " Acidose Respiratória Simples.";
                            }
                            else {
                                console.log("Acidose Respiratória associada a Alcalose Metabólica");
                                diagn += " Acidose Respiratória associada a Alcalose Metabólica.";
                            }
                        }
                    }
                    else if (ph > 7.45) { //ph básico
                        console.log("ph básico");
                        diagn = "PH básico.";
                        if (hco3 > 26 && paco2 < 35) {
                            console.log("Distúrbio Misto");
                            diagn += " Distúrbio Misto.";
                        }
                        else if (hco3 > 26) {
                            paco2Ini = 40 - (0.4 * (24 - hco3));
                            paco2Fin = 40 - (0.9 * (24 - hco3));
                            if (paco2 > paco2Fin && paco2 < paco2Ini) {
                                console.log("Alcalose Metabólica");
                                diagn += " Alcalose Metabólica Simples.";
                            }
                            else {
                                console.log("Alcalose Metabólica associada a Acidose Respiratória");
                                diagn += " Alcalose Metabólica associada a Acidose Respiratória.";
                            }
                        }
                        else if (paco2 < 35) {
                            hco3AgudaIni = 24 - (0.2 *(40 - paco2));
                            hco3AgudaFin = 24 - (0.25 *(40 - paco2));
                            hco3CronicaIni = 24 - (0.4 *(40 - paco2));
                            hco3CronicaFin = 24 - (0.5 *(40 - paco2));
                            if (!checkAguda && !checkCronica) {
                                alert("Selecione um Quadro Clínico.");
                                areaTexto.innerHTML = "";
                            }
                            else if ((hco3 > hco3AgudaIni && hco3 < hco3AgudaFin && checkAguda) || (hco3 > hco3CronicaIni && hco3 < hco3CronicaFin && checkCronica)) {
                                console.log("Alcalose Respiratória");
                                diagn += " Alcalose Respiratória Simples.";
                            }
                            else {
                                console.log("Alcalose Respiratória associada a Acidose Metabólica");
                                diagn += " Alcalose Respiratória associada a Acidose Metabólica.";
                            }
                        }
                    }
                    else { //ph normal
                        console.log("ph normal");
                        diagn = "PH normal.";
                    }
                    areaTexto.innerHTML = diagn;
                }
            }
        </script>

    </body>
</html>
